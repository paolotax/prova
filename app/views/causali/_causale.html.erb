<%= tag.div id: dom_id(causale), class: "grid grid-cols-1 md:grid-cols-12 gap-4 px-4 py-4 border-b border-gray-100 hover:bg-gray-50 transition-colors" do %>

  <!-- Mobile Layout -->
  <div class="md:hidden space-y-2">
    <div class="flex justify-between items-start">
      <div>
        <div class="font-bold text-lg text-gray-900"><%= causale.causale %></div>
        <div class="text-sm text-gray-500">
          <%= causale.magazzino %> • <%= causale.tipo_movimento&.humanize %> • <%= causale.movimento&.humanize %>
        </div>
      </div>
      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
        <%= causale.priorita %>
      </span>
    </div>

    <% if causale.stato_iniziale.present? %>
      <div class="text-sm">
        <span class="text-gray-500">Stato iniziale:</span>
        <span class="font-medium text-gray-700"><%= causale.stato_iniziale %></span>
      </div>
    <% end %>

    <% if causale.causali_successive_records.any? %>
      <div class="text-sm">
        <span class="text-gray-500">Può generare:</span>
        <div class="flex flex-wrap gap-1 mt-1">
          <% causale.causali_successive_records.each do |c| %>
            <span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-green-50 text-green-700 border border-green-200">
              <%= c.causale %>
            </span>
          <% end %>
        </div>
      </div>
    <% end %>

    <div class="flex gap-2 pt-2">
      <%= link_to causale_path(causale), class: "text-sm text-blue-600 hover:text-blue-800 font-medium" do %>
        Visualizza
      <% end %>
      <%= link_to edit_causale_path(causale), class: "text-sm text-gray-600 hover:text-gray-800 font-medium" do %>
        Modifica
      <% end %>
    </div>
  </div>

  <!-- Desktop Layout -->
  <div class="hidden md:contents">
    <div class="col-span-2 flex items-center">
      <span class="font-semibold text-gray-900"><%= causale.causale %></span>
    </div>

    <div class="col-span-1 flex items-center">
      <span class="text-gray-600"><%= causale.magazzino %></span>
    </div>

    <div class="col-span-2 flex items-center">
      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= causale.tipo_movimento == 'ordine' ? 'bg-yellow-100 text-yellow-800' : causale.tipo_movimento == 'vendita' ? 'bg-green-100 text-green-800' : 'bg-purple-100 text-purple-800' %>">
        <%= causale.tipo_movimento&.humanize %>
      </span>
    </div>

    <div class="col-span-1 flex items-center">
      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= causale.movimento == 'entrata' ? 'bg-blue-100 text-blue-800' : 'bg-red-100 text-red-800' %>">
        <%= causale.movimento&.humanize %>
      </span>
    </div>

    <div class="col-span-1 flex items-center justify-center">
      <span class="inline-flex items-center justify-center h-8 w-8 rounded-full text-sm font-bold <%= causale.priorita.to_i > 5 ? 'bg-red-100 text-red-800' : causale.priorita.to_i > 0 ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-600' %>">
        <%= causale.priorita %>
      </span>
    </div>

    <div class="col-span-2 flex items-center">
      <% if causale.stato_iniziale.present? %>
        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">
          <%= causale.stato_iniziale %>
        </span>
      <% else %>
        <span class="text-gray-400 text-xs">-</span>
      <% end %>
    </div>

    <div class="col-span-2 flex items-center">
      <% if causale.causali_successive_records.any? %>
        <div class="flex flex-wrap gap-1">
          <% causale.causali_successive_records.limit(3).each do |c| %>
            <span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-green-50 text-green-700 border border-green-200">
              <%= c.causale %>
            </span>
          <% end %>
          <% if causale.causali_successive_records.count > 3 %>
            <span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-600">
              +<%= causale.causali_successive_records.count - 3 %>
            </span>
          <% end %>
        </div>
      <% else %>
        <span class="text-gray-400 text-xs">Nessuna</span>
      <% end %>
    </div>

    <div class="col-span-1 flex items-center justify-center gap-2">
      <%= link_to causale_path(causale), class: "text-blue-600 hover:text-blue-800", title: "Visualizza" do %>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
      <% end %>
      <%= link_to edit_causale_path(causale), class: "text-gray-600 hover:text-gray-800", title: "Modifica" do %>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
        </svg>
      <% end %>
    </div>
  </div>

<% end %>
