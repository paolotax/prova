<% if params[:q] %>

    <%= hw_async_combobox_options @libri,
        render_in: { partial: "libri/librino", formats: [:html], as: :libro } %>

<% else %>

    <% if @page.first? %>



    <% else %>

        <%= turbo_stream.replace "load_more" do %>

            <% @page.records.each do |libro| %>
                <%= render libro %>
            <% end %>

            <% if @page.last? %>
                <%= tag.div "Fine dei Librini!", class: "py-8 px-4 text-center" %>
            <% else %>
                <%= turbo_frame_tag "load_more",
                            src: libri_path(request.query_parameters.merge(page: @page.next_param, format: :turbo_stream)),
                            loading: :lazy do %>
                    <%= render 'shared/lazy_loading' %>
                <% end %>
            <% end %>
        <% end %>
    <% end %>

<% end %>