<%= tag.div id: dom_id(libro),
    class: "item bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden hover:shadow-xl transition-all duration-300 cursor-pointer has-[:checked]:border-4 has-[:checked]:border-blue-500 has-[:checked]:ring-2 has-[:checked]:ring-blue-200",
    data: { action: "click->bulk-actions#toggle" } do %>

  <!-- Cover Image with Overlay Content -->
  <div class="aspect-[4/5] w-full bg-gray-100 relative overflow-hidden">
    <%= image_tag libro.avatar_url,
        class: "w-full h-full object-cover",
        alt: libro.titolo %>

    <!-- Gradient Overlay covering more from bottom -->
    <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/70 via-30% to-transparent to-60%"></div>

    <!-- Selection Checkbox -->
    <div class="absolute top-3 left-3">
      <%= check_box_tag "libro_ids[]", libro.id, nil,
          class: "peer sr-only",
          data: { action: "input->bulk-actions#count", bulk_actions_target: "checkbox" } %>

      <!-- Visual feedback when selected -->
      <div class="hidden peer-checked:block border-4 border-blue-500 bg-blue-500 rounded-full absolute items-center content-center justify-center peer-active:ring-2 peer-active:ring-blue-200">
        <svg class="w-8 h-8 text-white"
             xmlns="http://www.w3.org/2000/svg"
             viewBox="0 0 24 24"
             fill="none"
             stroke="currentColor"
             stroke-width="3"
             stroke-linecap="round"
             stroke-linejoin="round">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      </div>
    </div>

    <!-- Price Badge -->
    <div class="absolute top-3 right-3 bg-black/80 backdrop-blur-sm rounded-full px-3 py-1.5 shadow-lg">
      <span class="text-sm font-bold text-white">
        <%= number_to_currency(libro.prezzo_in_cents / 100.0) %>
      </span>
    </div>

    <!-- Overlaid Content -->
    <div class="absolute bottom-0 left-0 right-0 p-4 text-white space-y-2">

      <!-- Title and Publisher -->
      <div class="space-y-1">
        <%= link_to libro_path(libro),
            data: { turbo_frame: "_top", action: "click->bulk-actions#stopPropagation" },
            class: "block font-bold text-white hover:text-blue-300 line-clamp-2" do %>
          <%= libro.titolo %>
        <% end %>
        <p class="text-sm text-gray-300"><%= libro.editore&.editore %></p>
      </div>

      <!-- ISBN and Category -->
      <div class="space-y-1">
        <p class="text-xs text-gray-400"><%= libro.codice_isbn %></p>
        <p class="text-xs text-gray-400"><%= libro.categoria&.nome_categoria %></p>
      </div>

      <!-- Badges Row -->
      <div class="flex flex-wrap gap-1">
        <% unless libro.fascicoli_count.zero? %>
          <%= link_to libri_path(fascicoli: libro.id),
              data: { action: "click->bulk-actions#stopPropagation" } do %>
            <%= component('badge', text: libro.fascicoli_count, color: "yellow") %>
          <% end %>
        <% end %>
        <% unless libro.confezioni_count.zero? %>
          <%= link_to libri_path(confezioni: libro.id),
              data: { action: "click->bulk-actions#stopPropagation" } do %>
            <%= component('badge', text: libro.confezioni_count, color: "blue") %>
          <% end %>
        <% end %>
      </div>

      <!-- Stats Grid -->
      <div class="grid grid-cols-4 gap-2 pt-2 border-t border-white/20">

        <!-- Ordini -->
        <div class="text-center">
          <div class="text-xs text-gray-300">Ordini</div>
          <div class="<%= libro.giacenza&.ordini == 0 ? 'text-gray-500' : 'text-red-400' %> font-semibold">
            <%= libro.giacenza&.ordini || 0 %>
          </div>
        </div>

        <!-- Adozioni -->
        <div class="text-center">
          <div class="text-xs text-gray-300">Adozioni</div>
          <div class="<%= libro.adozioni_count == 0 ? 'text-gray-500' : 'text-green-400' %> font-semibold">
            <%= libro.adozioni_count %>
          </div>
        </div>

        <!-- Vendite -->
        <div class="text-center">
          <div class="text-xs text-gray-300">Vendite</div>
          <div class="<%= libro.giacenza&.vendite == 0 ? 'text-gray-500' : 'text-blue-400' %> font-semibold">
            <%= libro.giacenza&.vendite || 0 %>
          </div>
        </div>

        <!-- Carichi -->
        <div class="text-center">
          <div class="text-xs text-gray-300">Carichi</div>
          <div class="<%= libro.giacenza&.carichi == 0 ? 'text-gray-500' : 'text-purple-400' %> font-semibold">
            <%= libro.giacenza&.carichi || 0 %>
          </div>
        </div>

      </div>
    </div>
  </div>

<% end %>
