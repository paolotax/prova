<%= tag.div id: dom_id(libro), class: "bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden hover:shadow-xl transition-shadow duration-300" do %>

  <!-- Cover Image with Overlay Content -->
  <div class="aspect-[4/5] w-full bg-gray-100 relative overflow-hidden">
    <%= image_tag libro.avatar_url,
        class: "w-full h-full object-cover",
        alt: libro.titolo %>

    <!-- Gradient Overlay covering more from bottom -->
    <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/70 via-30% to-transparent to-60%"></div>

    <!-- Price Badge -->
    <div class="absolute top-2 right-2 bg-white/90 backdrop-blur-sm rounded-md px-2 py-1">
      <span class="text-sm font-semibold text-gray-900">
        <%= number_to_currency(libro.prezzo_in_cents / 100.0) %>
      </span>
    </div>

    <!-- Overlaid Content -->
    <div class="absolute bottom-0 left-0 right-0 p-4 text-white space-y-2">

      <!-- Title and Publisher -->
      <div class="space-y-1">
        <%= link_to libro_path(libro),
            data: { turbo_frame: "_top" },
            class: "block font-bold text-white hover:text-blue-300 line-clamp-2" do %>
          <%= libro.titolo %>
        <% end %>
        <p class="text-sm text-gray-300"><%= libro.editore&.editore %></p>
      </div>

      <!-- ISBN and Category -->
      <div class="space-y-1">
        <p class="text-xs text-gray-400"><%= libro.codice_isbn %></p>
        <p class="text-xs text-gray-400"><%= libro.categoria %></p>
      </div>

      <!-- Badges Row -->
      <div class="flex flex-wrap gap-1">
        <% unless libro.fascicoli_count.zero? %>
          <%= link_to libri_path(fascicoli: libro.id) do %>
            <%= component('badge', text: libro.fascicoli_count, color: "yellow") %>
          <% end %>
        <% end %>
        <% unless libro.confezioni_count.zero? %>
          <%= link_to libri_path(confezioni: libro.id) do %>
            <%= component('badge', text: libro.confezioni_count, color: "blue") %>
          <% end %>
        <% end %>
      </div>

      <!-- Stats Grid -->
      <div class="grid grid-cols-4 gap-2 pt-2 border-t border-white/20">

        <!-- Ordini -->
        <div class="text-center">
          <div class="text-xs text-gray-300">Ordini</div>
          <div class="<%= libro.giacenza&.ordini == 0 ? 'text-gray-500' : 'text-red-400' %> font-semibold">
            <%= libro.giacenza&.ordini || 0 %>
          </div>
        </div>

        <!-- Adozioni -->
        <div class="text-center">
          <div class="text-xs text-gray-300">Adozioni</div>
          <div class="<%= libro.adozioni_count == 0 ? 'text-gray-500' : 'text-green-400' %> font-semibold">
            <%= libro.adozioni_count %>
          </div>
        </div>

        <!-- Vendite -->
        <div class="text-center">
          <div class="text-xs text-gray-300">Vendite</div>
          <div class="<%= libro.giacenza&.vendite == 0 ? 'text-gray-500' : 'text-blue-400' %> font-semibold">
            <%= libro.giacenza&.vendite || 0 %>
          </div>
        </div>

        <!-- Carichi -->
        <div class="text-center">
          <div class="text-xs text-gray-300">Carichi</div>
          <div class="<%= libro.giacenza&.carichi == 0 ? 'text-gray-500' : 'text-purple-400' %> font-semibold">
            <%= libro.giacenza&.carichi || 0 %>
          </div>
        </div>

      </div>
    </div>
  </div>

<% end %>
