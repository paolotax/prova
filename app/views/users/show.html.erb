<div class="mt-10 sm:mx-auto sm:w-full sm:max-w-2xl">

    <section class="mt-8">
        <h1 class="text-2xl font-semibold"><%= @user.name %><span class="pl-2 text-sm text-gray-400 font-bold">  [<%= @user.role %>] </span></h1>
        <h2 class="mt-2 text-indigo-900 hover:text-indigo-600"><%= mail_to(@user.email) %></h2>
        <p class="mt-2 text-sm mb-2"><%= @user.partita_iva %></p>
        
        <!--Avatar Upload Form-->

        <div class="">
            <% if current_user.avatar.attached? %>
                <%= image_tag current_user.avatar_thumbnail %>
            <% end %>
        </div>
<div class="mt-12 sm:mt-4 sm:flex sm:flex-row-reverse">
    <%= link_to "Modifica Utente", edit_user_registration_path(@user), class: "mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto" %>
</div>
        <%= form_with url: modifica_navigatore_user_path(current_user), 
                data: { controller: "tax-select", 
                action: "change->tax-select#submit" }  do|f| %>
            <hr/> 
            <div class="flex items-center justify-start gap-x-4 py-2">
                <%= f.label :navigator, "Navigatore preferito", class: "label" %>
                <div>
                    <%= f.select :navigator, 
                            options_for_select(["apple", "google", "waze"], @user.navigator), 
                            { prompt: "scegli il navigatore" }, 
                            { class: "field", data: { tax_dropdown_target: "navigator" } } %>
                </div>
                <%= f.submit "Modifica", class:"hidden" %>
            </div>
            <hr/> 
        <% end %>   
        <span class="block mt-5 text-xs text-right">Member Since <%= @user.created_at.strftime("%B %Y") %></span>
    
    </section>

    <!-- sezione La mia Zona -->
    <section class="mt-8">

        <div class="py-2">
                       
            <div class="flex justify-between border-b-2 border-gray-300">
                <h2 class="font-semibold">La mia ZONA </h2>
                <%= tag.div id:"#{dom_id(@user)}-nr-scuole-assegnate",
                    class: "text-sm font-semibold pr-4" do %>
                    <%= @user.import_scuole.count %>
                <% end %>    
            </div>

            <div id="user-scuole" class="max-h-96 overflow-scroll">
                <% @mia_zona.each do |zona, count|%>
                    
                    <div id="<%= (zona[1] + "-" + zona[2]).downcase.gsub(" ", "-") %>" class="bg-white px-2 py-4 grid grid-cols-6 justify-between align-center border-b border-gray-300">
                        <div class="text-sm col-span-4">
                            <span><%= zona.join " -> " %></span>
                        </div>
                        <div class="text-right">
                            <span><%= count %></span>
                        </div>
                        <div class="flex justify-end">
                            <%= button_to "-", rimuovi_scuole_user_path(provincia: zona[1], tipo: zona[2]), method: :delete, 
                                class: "mr-2 h-7 w-7 rounded-full bg-red-600 p-1 text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600" 
                            %>
                        </div>
                    </div>
                
                <% end %>
            </div>
        </div>

        <div class="mt-8 mb-4 mx-2 p-4 flex flex-col bg-gray-300 border rounded">
            
            <%= render partial: "zone/form", locals: { regioni: @regioni, province: [], gradi: @gradi, tipi: @tipi }%>

            <%= form_with url: assegna_scuole_user_path(@user), class: "flex flex-row-reverse mt-4" do |f| %>
                
                <%= hidden_field_tag "hregione" %>
                <%= hidden_field_tag "hprovincia" %>
                <%= hidden_field_tag "hgrado" %>
                <%= hidden_field_tag "htipo" %>

                <%= f.button type: "submit", class: "flex flex-row-reverse ml-4 h-7 w-7 rounded-full bg-indigo-600 p-1 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600" do %>
                    <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                    </svg>            
                <% end%>  
            <% end %>
        </div>

    </section>   

    <!-- sezione i miei EDITORI -->
    <section class="mt-10">
        
        <div class="py-2">
            <div class="flex justify-between border-b-2 border-gray-300">
                <h2 class="font-semibold">I miei editori </h2>
                <div id="<%= dom_id(current_user) %>-nr-editori" class="text-sm font-semibold pr-4">
                    <%= current_user.editori.count %>
                </div>
            </div>  
        
            <div id="user-editori" class="">                 
                <% current_user.mandati.each do |mandato| %>
                    <%= render partial: "mandati/mandato", locals: { mandato: mandato } %>
                <% end %>
            </div>
        </div>

        <div class="mt-8 mb-4 mx-2 p-4 flex flex-col bg-gray-300 border rounded">

            <%= render partial: "mandati/form", locals: { gruppi: @gruppi, editori: [] } %>

            <%= form_with url: mandati_path, method: :post, class: "flex flex-row-reverse mt-4" do |f| %>
                <%= hidden_field_tag :user_id, value: current_user.id %>
                <%= hidden_field_tag "hgruppo" %>
                <%= hidden_field_tag "heditore" %>

                <%= f.button type: "submit", class: "h-7 w-7 rounded-full bg-indigo-600 p-1 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600" do %>
                    <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                    </svg>            
                <% end%>     
            <% end %>  
        </div>

    </section>  
    
    <section class="mt-10">
        <%= turbo_frame_tag :user_scuole, src: user_scuole_path(current_user), loading: :lazy do %>
            <%= render 'shared/lazy_loading' %>
        <% end%>
    </section>

</div>


<div class="mt-12 sm:mx-auto sm:w-full sm:max-w-2xl">       

</div>



<% if current_user.name == "CAMBIARE SUBITO" %>
    <div class="mt-20 sm:mx-auto sm:w-full sm:max-w-2xl">

        <div>
            <%= form_with url: assegna_scuole_user_path(@user) do |f| %>
                <div class="flex flex-col mt-10 max-w-4xl mx-auto">
                    <%= render(FancySelect.new( form_name: :provincia, items: @provincia_items, label: "Scegli la provincia" ))  %>
                    <%= render(FancySelect.new( form_name: :grado, items: @grado_items, label: "Scegli il grado scolastico" ))  %>     
                    <%= render(FancySelect.new( form_name: :tipo, items: @tipo_items, label: "Scegli il tipo scuola" ))  %>     

                </div>
            <% end %>
        </div>  

        <div>
            <%= form_with url: "#" do |f| %>
                <div class="flex flex-col mt-10 max-w-4xl mx-auto">
                    <%= render(FancySelect.new( form_name: :editore, items: @editore_items, label: "Scegli l'editore" ))  %>
              
                </div>
            <% end %>
        </div> 
    </div>
<% end %>

