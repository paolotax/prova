 <%# locals: ( import_adozione:, is_header: true, is_mia: false ) -%>

<%= tag.div class: [
                "py-2 px-2 w-full border rounded-lg transition-all duration-200": true,
                # NON mie - sempre bianche
                "bg-white": !is_mia,
                # MIE da acquistare - giallo acceso
                "bg-yellow-200": is_mia && import_adozione.respond_to?(:da_acquistare?) && import_adozione.da_acquistare?,
                # MIE non da acquistare - giallo pallido
                "bg-yellow-50": is_mia && (!import_adozione.respond_to?(:da_acquistare?) || !import_adozione.da_acquistare?),
                # Quando selezionate
                "cursor-pointer has-[:checked]:border-4 has-[:checked]:border-blue-500 has-[:checked]:ring-2 has-[:checked]:ring-blue-200 has-[:checked]:bg-blue-50": !is_header && is_mia,
                "hover:brightness-95": !is_header
            ],
            data: !is_header && is_mia ? { action: "click->bulk-actions#toggle" } : {} do %>

    <%= tag.div class: "flex flex-col" do %>
        <%= tag.div class: "flex flex-row justify-between" do %>
            <%= tag.div import_adozione.classe_e_sezione, class: "text-gray-800 font-semibold" %>

            <% unless is_header %>
                <%= tag.div class: "flex items-center gap-2" do %>
                    <% if is_mia %>
                        <%= check_box_tag "import_adozione_ids[]", import_adozione.id, nil,
                                form: "bulk-actions",
                                class: "peer sr-only",
                                data: { action: "input->bulk-actions#count", bulk_actions_target: "checkbox" } %>

                        <!-- Visual feedback when selected -->
                        <div class="hidden peer-checked:flex items-center justify-center w-6 h-6 border-2 border-blue-500 bg-blue-500 rounded-full">
                            <svg class="w-4 h-4 text-white"
                                 xmlns="http://www.w3.org/2000/svg"
                                 viewBox="0 0 24 24"
                                 fill="none"
                                 stroke="currentColor"
                                 stroke-width="3"
                                 stroke-linecap="round"
                                 stroke-linejoin="round">
                              <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </div>

                        <!-- Menu dropdown - nascosto quando selezionato -->
                        <div class="peer-checked:hidden" data-action="click->bulk-actions#stopPropagation">
                            <%= render partial: "import_adozioni/card_menu", locals: { import_adozione: import_adozione } %>
                        </div>
                    <% else %>
                        <div data-action="click->bulk-actions#stopPropagation">
                            <%= render partial: "import_adozioni/card_menu", locals: { import_adozione: import_adozione } %>
                        </div>
                    <% end %>
                <% end %>
            <% end %>

        <% end %>
        <%= tag.span import_adozione.combinazione, class: "line-clamp-2 hover:line-clamp-none pt-0.5 pr-4 pb-1 text-gray-500 font-semibold text-xs" %>
    <% end %>

    <% if is_mia && import_adozione.adozione_comunicata&.alunni.present? %>
        <%= tag.div class: "flex items-center gap-1 mt-1 text-xs text-purple-600" do %>
            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M4.5 6.375a4.125 4.125 0 118.25 0 4.125 4.125 0 01-8.25 0zM14.25 8.625a3.375 3.375 0 116.75 0 3.375 3.375 0 01-6.75 0zM1.5 19.125a7.125 7.125 0 0114.25 0v.003l-.001.119a.75.75 0 01-.363.63 13.067 13.067 0 01-6.761 1.873c-2.472 0-4.786-.684-6.76-1.873a.75.75 0 01-.364-.63l-.001-.122zM17.25 19.128l-.001.144a2.25 2.25 0 01-.233.96 10.088 10.088 0 005.06-1.01.75.75 0 00.42-.643 4.875 4.875 0 00-6.957-4.611 8.586 8.586 0 011.71 5.157v.003z" />
            </svg>
            <span class="font-medium"><%= import_adozione.adozione_comunicata.alunni %></span>
        <% end %>
    <% end %>

    <% if is_mia && !is_header %>
        <%= render partial: "import_adozioni/card_ssk", locals: { import_adozione: import_adozione, tipo_card: "classe" } %>
    <% end %>

<% end %>
