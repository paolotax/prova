<%# locals: (grouped: :classe) -%>

<% if grouped == :titolo %>
    <% @import_scuola.import_adozioni.grouped_titolo.each do |c| %>
        
        <%= tag.div class: [
                        "my-3 px-3 flex justify-between  border-b": true,
                        "bg-white":   !@miei_editori.include?(c.EDITORE),
                        "bg-yellow-200": (@miei_editori.include?(c.EDITORE))     
                    ] do %>

            <%= tag.div class: "my-3 px-3 flex flex-col w-full" do %>            
                <%= tag.div c.titolo %>
                <%= tag.div class: [
                    "flex flex-row justify-between": true ] do %>
                    <%= tag.div c.editore %>
                    <%= tag.div c.disciplina %>
                <% end %>
            <% end %>
            
            <%= tag.div class: "px-5 py-4 grid grid-cols-3 gap-2 sm:grid-cols-4 sm:gap-4" do %>
                <% adozioni =  @import_scuola.import_adozioni.find  c.import_adozioni_ids %>
                <% adozioni.sort_by(&:SEZIONEANNO).each do |a| %>

                    <%= link_to new_appunto_path(import_scuola_id: @import_scuola.id,
                                        import_adozione_id: a.id),
                                    data: { turbo_frame: :modal, action: "click->dialog#open"},
                                    class: "col-span-1 p-2.5 border rounded-md flex flex-col" do %>

                        <%= tag.div a.classe_e_sezione, class: "text-gray-800 font-semibold"  %>
                        <%= tag.div a.combinazione, class: "text-gray-500 font-semibold text-xs truncate" %>
                    <% end %>
                <% end %>
            <% end %>
        <% end %>
    <% end %>

<% else  %>

        <% @import_scuola.import_adozioni.grouped_classe.each do |c| %>
        
            <%= tag.div class: [
                        "my-3 px-3 flex border-b": true    
            ] do %>

            <%= tag.div class: "col-span-1 p-2.5 border rounded-md flex flex-col" do %>
                <%= tag.div c.classe_e_sezione, class: "text-gray-800 font-semibold"  %>
                <%= tag.div c.combinazione, class: "text-gray-500 font-semibold text-xs truncate" %>
            <% end %>
            
            <%= tag.div class: "grid grid-cols-3 gap-2 sm:grid-cols-4 sm:gap-4" do %>
                <% adozioni =  @import_scuola.import_adozioni.find  c.import_adozioni_ids %>
                <% adozioni.sort_by(&:DISCIPLINA).each do |a| %>

                    <%= tag.div class: [
                                    "my-3 px-3 flex justify-between  border-b": true,
                                    "bg-white":   !@miei_editori.include?(a.EDITORE),
                                    "bg-yellow-200": @miei_editori.include?(a.EDITORE)    
                                ] do %>
                        <%= link_to new_appunto_path(import_scuola_id: @import_scuola.id,
                                            import_adozione_id: a.id),
                                        data: { turbo_frame: :modal, action: "click->dialog#open"},
                                        class: "flex flex-col" do %>

                            <%= tag.div a.titolo, class: "text-gray-800 font-semibold"  %>
                            <%= tag.div a.editore, class: "text-gray-500 font-semibold text-xs truncate" %>
                            <%= tag.div a.disciplina, class: "text-gray-500 font-semibold text-xs truncate" %>
                        <% end %>
                    <% end %>
                <% end %>
            <% end %>
        <% end %>
    <% end %>
<% end %>

